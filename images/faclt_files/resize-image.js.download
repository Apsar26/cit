window.bridges["resize-image"]=function(){var r={data:null,wrapper:null,preview:null},o={data:null,wrapper:null,preview:null},f=!0,T=!1,d={input:!0,output:!0},c={width:0,height:0},H=10,g=-1,B=document.createElement("canvas"),M=["top left","middle left","bottom left","top","bottom","top right","middle right","bottom right"];function S(e,a,t){var i=m(t);if(!!i){var p=0,n=0,l=i.width,u=i.height,s={x:n,y:p,w:l,h:u};return g=R(s,e,a),g>-1}}function k(e){return g>=0?(scrollPrevented=!1,g=-1,!0):!1}function I(e,a,t){var i=m(t);if(!!i){var p=0,n=0,l=i.width,u=i.height,s=i.ratio,v=q(g,e,a),W={width:parseInt(l+(v.right-v.left)||1),height:parseInt(u+(v.bottom-v.top)||1)};s?(v.top&&Interactable.changePreviewPosition(t.input.element.querySelector(".preview"),0,v.top),v.left&&Interactable.changePreviewPosition(t.input.element.querySelector(".preview"),v.left,0)):Interactable.changePreviewPosition(t.input.element.querySelector(".preview"),v.left,v.top),t.options.set(W)}}var P=function(){var e=this;if(e.trigger==Trigger.RESTORE&&e.options.set({recrop:!1}),(e.trigger==Trigger.IMPORT||e.trigger==Trigger.EXAMPLE)&&(d.input=!0,d.output=!0),r.data||(r.data=e.input.element.querySelector(".data"),r.preview=e.input.element.querySelector(".preview"),r.wrapper=r.preview.parentElement,r.background=e.input.element.querySelector(".background"),o.data=e.output.element.querySelector(".data"),o.preview=e.output.element.querySelector(".preview"),o.wrapper=o.preview.parentElement,o.background=e.output.element.querySelector(".background"),Interactable.make(r.preview,{onclick:function(u,s){S(u,s,e)&&Interactable.disableScroll(r.preview)},onrelease:function(u,s){k()&&Interactable.enableScroll(r.preview)},onscroll:function(u,s){d.input=!1,g>=0&&I(u,s,e),e.convert()}}),Interactable.make(o.preview,{onscroll:function(u,s){d.input=!1,d.output=!1,e.convert()}})),!(f&&(f=e.input.element.querySelector(".side-box").classList.contains("empty"),f))){r.background.width=r.background.clientWidth,r.background.height=r.background.clientHeight,o.background.width=o.background.clientWidth,o.background.height=o.background.clientHeight,r.preview.width=r.wrapper.clientWidth,r.preview.height=r.wrapper.clientHeight,o.preview.width=o.wrapper.clientWidth,o.preview.height=o.wrapper.clientHeight,b(r.background),b(o.background);var a=m(e);if(!!a){var t=a.width,i=a.height,p=a.ratio;t<=0&&(t=1,e.options.set({width:t})),i<=0&&(i=1,e.options.set({height:i})),c.width&&p&&(c.width!=t?(i=Math.round(r.data.height/(r.data.width/t)),e.options.set({height:i})):c.height!=i&&(t=Math.round(r.data.width/(r.data.height/i)),e.options.set({width:t}))),d.input&&Interactable.centerPreview(r.preview,t/2,i/2),d.input=!0,d.output&&Interactable.centerPreview(o.preview,t/2,i/2),d.output=!0,c.width=t,c.height=i,e.input.showStatus(r.data.width+"\xD7"+r.data.height),e.output.showStatus(t+"\xD7"+i);var n=Interactable.getPreviewPosition(r.preview),l=r.preview.getContext("2d");l.drawImage(r.data,0,0,r.data.width,r.data.height,n.x,n.y,t,i),C(r.preview,n.x,n.y,t,i),l=o.data.getContext("2d"),o.data.width=t,o.data.height=i,l.clearRect(0,0,t,i),l.drawImage(r.data,0,0,t,i),e.respond(),l=o.preview.getContext("2d"),n=Interactable.getPreviewPosition(o.preview),l.drawImage(o.data,n.x,n.y),(r.preview.clientWidth!=r.preview.width||r.preview.clientHeight!=r.preview.height)&&(r.preview.style.width=r.preview.width+"px",o.preview.style.width=o.preview.width+"px",r.preview.style.height=r.preview.height+"px",o.preview.style.height=o.preview.height+"px")}}};function isInRect(e,a,t){return a>=e.x&&t>=e.y&&a<=e.x+e.w&&t<=e.y+e.h}function R(e,mouseX,mouseY){var r=16;points=null;with(e){for(var points=[{x:x,y:y},{x:x,y:y+h/2},{x:x,y:y+h},{x:x+w/2,y:y},{x:x+w/2,y:y+h},{x:x+w,y:y},{x:x+w,y:y+h/2},{x:x+w,y:y+h}],i=0;i<points.length;i++){var p=points[i],rect={x:p.x-r/2,y:p.y-r/2,w:r,h:r};if(isInRect(rect,mouseX,mouseY))return i}return-1}}function q(e,a,t){var i={top:0,left:0,right:0,bottom:0};return e==0?(i.top+=t,i.left+=a):e==1?i.left+=a:e==2?(i.left+=a,i.bottom+=t):e==3?i.top+=t:e==4?i.bottom+=t:e==5?(i.top+=t,i.right+=a):e==6?i.right+=a:e==7&&(i.right+=a,i.bottom+=t),i}function C(e,a,t,i,p){var n=e.getContext("2d"),l=10;n.strokeStyle="black",n.fillStyle="white",n.lineWidth=2,n.beginPath(),n.rect(a,t,i,p),n.stroke(),n.closePath();for(var u=[{x:a,y:t},{x:a,y:t+p/2},{x:a,y:t+p},{x:a+i/2,y:t},{x:a+i/2,y:t+p},{x:a+i,y:t},{x:a+i,y:t+p/2},{x:a+i,y:t+p}],s=0;s<u.length;s++){var v=u[s];n.beginPath(),n.rect(parseInt(v.x-l/2),parseInt(v.y-l/2),l,l),n.fill(),n.stroke(),n.closePath()}}function m(e){var a=e.options.get(),t=+a.width,i=+a.height,p=e.input.element.querySelector(".data");return isNaN(t)?(e.input.showNegativeBadge("Can't crop.","Width is not a number.",-1),!1):isNaN(i)?(e.input.showNegativeBadge("Can't crop.","Height is not a number.",-1),!1):(a.width==""&&(t=p.width),a.height==""&&(i=p.height),{top:0,left:0,width:t,height:i,ratio:a.ratio})}function b(e){for(var a=e.getContext("2d"),t=e.width,i=e.height,p=15,n=!0,l=0;l<=t;l+=p)for(var u=0;u<=i;u+=p)n?a.fillStyle="#ffffff":a.fillStyle="#efefef",n=!n,a.fillRect(l,u,l+p,u+p)}function E(){var e=this,a={png:"image/png",jpg:"image/jpeg"},t=this.options.get().extension||"png",i=e.output.element.querySelector(".data");if(t=="png"||t=="jpg")i.toBlob(function(n){saveAs(n,"output-"+e.siteName+"."+t)},a[t]);else if(t=="bmp"){var p=CanvasToBMP.toBlob(i);saveAs(p,"output-"+e.siteName+".bmp")}}function N(){return this.options.get().extension||"png"}return{converter:P,config:{type:"image",input:{import:"base64",noClipboard:!0,download:N,image:!0},output:{noClipboard:!0},override:{"output.download":E}}}};
